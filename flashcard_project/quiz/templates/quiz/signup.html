{% extends 'quiz/base.html' %}

{% block head_extra %}
<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #020617; /* bg-slate-950 */
    }
    .background-lines {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background-color: #020617;
        background-image: linear-gradient(white 0.5px, transparent 0.5px),
                            linear-gradient(90deg, white 0.5px, transparent 0.5px);
        background-size: 3rem 3rem;
        animation: move-lines 15s linear infinite;
        mask-image: radial-gradient(ellipse 80% 50% at 50% 0%, black 40%, transparent 100%);
        z-index: 0;
    }
    @keyframes move-lines {
        0% { background-position: 0 0; }
        100% { background-position: -3rem 0; }
    }
    .form-input {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(71, 85, 105, 0.5);
        transition: all 0.3s ease;
    }
    .form-input:focus {
        background: rgba(30, 41, 59, 0.9);
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .gradient-text {
        background: linear-gradient(to bottom, #e2e8f0, #64748b);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .btn-primary {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        transition: all 0.3s ease;
    }
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
    }
    .glass-card {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(71, 85, 105, 0.2);
    }
    .strength-bar { height: 3px; border-radius: 2px; transition: all 0.3s ease; }
    .strength-weak { background-color: #ef4444; width: 25%; }
    .strength-fair { background-color: #f59e0b; width: 50%; }
    .strength-good { background-color: #10b981; width: 75%; }
    .strength-strong { background-color: #059669; width: 100%; }
    /* This rule now only hides the nav from base.html */
    body > nav {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="relative w-full min-h-screen overflow-hidden flex flex-col">
    <div class="background-lines"></div>

    <div class="relative z-10 px-4 sm:px-6 lg:px-8 flex flex-col flex-grow">
        <header class="max-w-7xl mx-auto py-6 w-full">
            <nav class="flex justify-between items-center">
                <a href="/" class="flex items-center space-x-2">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-blue-500"><path d="M9 8C10.6569 8 12 6.65685 12 5C12 3.34315 10.6569 2 9 2C7.34315 2 6 3.34315 6 5C6 6.65685 7.34315 8 9 8Z" stroke="currentColor" stroke-width="1.5"/><path d="M18.5 4H15.5C14.3954 4 13.5 4.89543 13.5 6V10C13.5 11.1046 14.3954 12 15.5 12H18.5C19.6046 12 20.5 11.1046 20.5 10V6C20.5 4.89543 19.6046 4 18.5 4Z" stroke="currentColor" stroke-width="1.5"/><path d="M3.5 14.5C3.5 13.3954 4.39543 12.5 5.5 12.5H12.5C13.6046 12.5 14.5 13.3954 14.5 14.5V21.5C14.5 22.0523 14.0523 22.5 13.5 22.5H6.5C4.84315 22.5 3.5 21.1569 3.5 19.5V14.5Z" stroke="currentColor" stroke-width="1.5"/></svg>
                    <span class="font-extrabold text-2xl text-white">MEMRACE</span>
                </a>
                <div class="flex items-center space-x-4">
                    <a href="{% url 'signin' %}" class="text-neutral-300 hover:text-white transition-colors">Already have an account? <span class="text-blue-400 hover:text-blue-300">Sign In</span></a>
                </div>
            </nav>
        </header>

        <main class="flex-grow flex items-center justify-center py-12">
            <div class="max-w-md w-full">
                <div class="text-center mb-8">
                    <h1 class="gradient-text text-3xl md:text-4xl font-bold mb-4">Join MEMRACE</h1>
                    <p class="text-neutral-400 text-lg">Start your intelligent learning journey today</p>
                </div>

                <div class="glass-card rounded-2xl p-8 shadow-2xl">
                    <form id="signupForm" method="post" class="space-y-6">
                        {% csrf_token %}
                        <!-- Full Name -->
                        <div>
                            <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-neutral-300 mb-2">Full Name</label>
                            <input type="text" name="{{ form.first_name.name }}" id="{{ form.first_name.id_for_label }}" required class="form-input w-full px-4 py-3 rounded-lg text-white placeholder-neutral-500 focus:outline-none" placeholder="Enter your full name">
                        </div>
                        <!-- Username -->
                        <div>
                            <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-neutral-300 mb-2">Username</label>
                            <input type="text" name="{{ form.username.name }}" id="{{ form.username.id_for_label }}" required class="form-input w-full px-4 py-3 rounded-lg text-white placeholder-neutral-500 focus:outline-none" placeholder="Choose a username">
                        </div>
                        <!-- Email -->
                        <div>
                            <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-neutral-300 mb-2">Email Address</label>
                            <input type="email" name="{{ form.email.name }}" id="{{ form.email.id_for_label }}" required class="form-input w-full px-4 py-3 rounded-lg text-white placeholder-neutral-500 focus:outline-none" placeholder="Enter your email">
                        </div>
                        <!-- Password -->
                        <div>
                            <label for="{{ form.password1.id_for_label }}" class="block text-sm font-medium text-neutral-300 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" name="{{ form.password1.name }}" id="{{ form.password1.id_for_label }}" required class="form-input w-full px-4 py-3 rounded-lg text-white placeholder-neutral-500 focus:outline-none pr-12" placeholder="Create a strong password">
                                <button type="button" id="togglePassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-400 hover:text-white"><svg id="eyeOpen" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg><svg id="eyeClosed" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg></button>
                            </div>
                            <div class="mt-2"><div class="flex justify-between items-center mb-1"><span class="text-xs text-neutral-400">Password strength</span><span id="strengthText" class="text-xs text-neutral-400"></span></div><div class="w-full bg-slate-700 rounded-full h-1"><div id="strengthBar" class="strength-bar"></div></div></div>
                        </div>
                        <!-- Confirm Password -->
                        <div>
                            <label for="{{ form.password2.id_for_label }}" class="block text-sm font-medium text-neutral-300 mb-2">Confirm Password</label>
                            <input type="password" name="{{ form.password2.name }}" id="{{ form.password2.id_for_label }}" required class="form-input w-full px-4 py-3 rounded-lg text-white placeholder-neutral-500 focus:outline-none" placeholder="Confirm your password">
                            <div id="passwordMatch" class="mt-1 text-xs hidden"></div>
                        </div>
                        <!-- Display Form Errors -->
                        {% if form.errors %}
                            <div class="p-3 bg-red-900/50 border border-red-500/50 rounded-lg text-red-300 text-sm">
                                Please correct the errors below.
                                {{ form.non_field_errors }}
                            </div>
                        {% endif %}
                        <!-- Submit Button -->
                        <button type="submit" class="btn-primary w-full py-3 px-6 rounded-lg text-white font-semibold focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">Create Account</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
        const confirmPasswordInput = document.getElementById('{{ form.password2.id_for_label }}');

        // Password visibility toggle
        document.getElementById('togglePassword').addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            document.getElementById('eyeOpen').classList.toggle('hidden');
            document.getElementById('eyeClosed').classList.toggle('hidden');
        });

        // Password strength checker
        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            let score = strength;
            strengthBar.className = 'strength-bar';
            if (score <= 2) { strengthBar.classList.add('strength-weak'); strengthText.textContent = 'Weak'; }
            else if (score === 3) { strengthBar.classList.add('strength-fair'); strengthText.textContent = 'Fair'; }
            else if (score === 4) { strengthBar.classList.add('strength-good'); strengthText.textContent = 'Good'; }
            else if (score === 5) { strengthBar.classList.add('strength-strong'); strengthText.textContent = 'Strong'; }
        });

        // Password confirmation checker
        const passwordMatch = document.getElementById('passwordMatch');
        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirm = confirmPasswordInput.value;
            if (confirm.length > 0) {
                passwordMatch.classList.remove('hidden');
                if (password === confirm) {
                    passwordMatch.textContent = '✓ Passwords match';
                    passwordMatch.className = 'mt-1 text-xs text-green-400';
                } else {
                    passwordMatch.textContent = '✗ Passwords do not match';
                    passwordMatch.className = 'mt-1 text-xs text-red-400';
                }
            } else {
                passwordMatch.classList.add('hidden');
            }
        }
        passwordInput.addEventListener('input', checkPasswordMatch);
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);

        // THE SUBMIT EVENT LISTENER THAT CAUSED THE PROBLEM HAS BEEN REMOVED.
        // The form will now submit directly to the Django backend.
    </script>
{% endblock %}
